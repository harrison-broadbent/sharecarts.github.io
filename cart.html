<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Continue to Amazon</title>
    <meta
      property="og:title"
      content="I want to share my cart with you! Check it out!"
    />
    <meta property="og:image" content="https://sharecarts.com/og-image.png" />
    <meta
      property="og:description"
      content="Add the same items to your own cart."
    />
    <meta property="og:type" content="website" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-M2TZ6RBVLX"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-M2TZ6RBVLX");
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style type="text/tailwindcss">
      @theme {
        --font-inter: "Inter", Helvetica, sans-serif;
      }
    </style>
    <link
      href="https://cdn.jsdelivr.net/combine/npm/daisyui@5/components/tooltip.css,npm/daisyui@5/components/modal.css,npm/daisyui@5/theme/light.css"
      rel="stylesheet"
      type="text/css"
    />
  </head>
  <body class="font-inter h-full w-full max-w-2xl mx-auto">
    <div class="min-h-[95vh] py-4 px-3">
      <header class="flex justify-between">
        <div id="cart_info" class="tooltip tooltip-right" data-tip="Learn More">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-7 cursor-pointer hover:opacity-70"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"
            />
          </svg>
        </div>
        <div class="text-sm mt-1 sm:text-lg italic font-bold tracking-tight">
          Someone shared
          <span class="text-stone-500 underline" id="quantity"></span> with you!
        </div>
        <div
          id="share_button"
          class="tooltip tooltip-left"
          data-tip="Share Link"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-7 cursor-pointer hover:opacity-70"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"
            />
          </svg>
        </div>
      </header>
      <span
        class="mt-10 sm:mt-15 text-amber-950 text-2xl sm:text-3xl font-extrabold block text-center tracking-tight"
      >
        Add them to your cart below
      </span>
      <div
        id="container"
        class="bg-amber-50 px-2 py-6 sm:px-20 rounded-md mt-4 border-2 border-dashed border-amber-200"
      >
        <!-- Regular AMAZON -->
        <a
          id="amz"
          target="_blank"
          href=""
          class="hidden shadow-sm cursor-pointer w-full rounded-full block text-center font-semibold bg-amber-400 hover:bg-amber-500 px-4 py-3 text-amber-950 text-lg sm:text-xl after:content-['_➜']"
          >Continue to Amazon<span id="tld"></span
        ></a>

        <!-- Fresh or WF -->
        <form id="freshWF" class="hidden" method="POST" action="">
          <input type="hidden" id="ingredients" name="ingredients" value="" />
          <input type="hidden" id="almBrandId" name="almBrandId" value="" />
          <input type="hidden" id="tag" name="associateTag" value="" />
          <input
            type="submit"
            class="cursor-pointer shadow-sm w-full rounded-full block text-center font-semibold bg-amber-400 hover:bg-amber-500 py-3 text-amber-950 text-lg sm:text-xl"
            value=""
          />
        </form>
      </div>
      <div
        id="note"
        class="hidden mt-5 p-4 bg-stone-50 rounded-md shadow-sm border border-dashed border-stone-100 text-sm"
      >
        <span class="italic">Note</span>:
        <span id="noteMessage"></span>
      </div>
      <div class="mt-10 text-stone-900">
        <h3
          class="text-center text-amber-950 text-xl tracking-tight font-semibold mb-2"
        >
          Help
        </h3>
        <div class="space-y-3 font-light">
          <details id="help_first" class="text-sm">
            <summary class="cursor-pointer hover:text-stone-600">
              What happens when I click '<span class="italic"
                >Continue to Amazon</span
              >'?
            </summary>
            <p class="leading-7 pl-5 text-stone-800">
              It will take you to a confirmation page on Amazon.
            </p>
            <p class="leading-7 pl-5 text-stone-800">
              <mark id="instructions" class="bg-amber-200 font-medium p-1"
                >Click the 'Add To Cart' button.</mark
              >
            </p>
            <p class="pl-5 italic text-stone-800">
              It does not remove any items already in your cart.
            </p>
          </details>

          <details class="text-sm">
            <summary class="cursor-pointer hover:text-stone-600">
              Does this cart link stay updated?
            </summary>
            <p class="leading-7 pl-5 text-stone-800">
              <em>No</em>, the link reflects all cart items at the time it was
              created.
            </p>
            <p class="pl-5 text-stone-800">
              To make changes, use our
              <a
                class="text-blue-600 hover:text-stone-800"
                href="/create.html"
                >tool</a
              >
              to create a new link.
            </p>
          </details>

          <details class="text-sm">
            <summary class="cursor-pointer hover:text-stone-600">
              Can I share my cart?
            </summary>
            <p class="leading-7 pl-5 text-stone-800">
              <em>Yes</em>, <strong>all</strong> Amazon carts and items can be
              shared!
            </p>
            <p class="pl-5 text-stone-800">
              Use our
              <a
                class="text-blue-600 hover:text-stone-800"
                href="/create.html"
                >tool</a
              >
              to create a shareable cart link.
            </p>
          </details>

          <details class="text-sm">
            <summary class="cursor-pointer hover:text-stone-600">
              Have a different question?
            </summary>
            <p class="leading-7 pl-5 text-stone-800">
              Reach out
              <a
                class="text-blue-600 hover:text-stone-800"
                target="_blank"
                href="https://docs.google.com/forms/d/e/1FAIpQLSfgVkcPvPheLw9ZHLaRdNR01EJGiT9i0MiUyf64GFaiwyw4Mg/viewform?pli=1"
                >here</a
              >
              and we’ll get back to you as soon as possible.
            </p>
          </details>
        </div>
        <p
          id="disclosure"
          class="mt-4 text-[10px] font-light text-center text-stone-400"
        >
          As an Amazon Associate I earn from qualifying purchases.
        </p>
      </div>
    </div>
    <footer
      class="mt-2 p-3 text-xs text-center font-light border-t border-stone-200"
    >
      <span>
        © Share Carts, 2025 |
        <a class="underline" href="mailto:support@sharecarts.com">Contact Us</a>
        |
        <a class="underline" href="/privacy.html" target="_blank"
          >Privacy Policy</a
        >
      </span>
    </footer>
    <!-- Dialogs -->
    <dialog id="cart_details" class="modal">
      <div class="modal-box">
        <form method="dialog">
          <button
            class="btn btn-sm btn-circle btn-ghost absolute right-4 top-4 cursor-pointer hover:opacity-70"
          >
            ✕
          </button>
        </form>
        <span
          class="block text-center text-amber-950 text-xl tracking-tight font-semibold"
        >
          Cart Details
        </span>
        <p class="text-sm sm:text-base text-center italic">
          This is a shareable Amazon shopping cart.
        </p>
        <div class="mt-5 flex flex-col sm:flex-row sm:justify-around">
          <div>
            <span class="block text-amber-950 tracking-tight underline"
              >Receive:</span
            >
            <ol
              class="leading-6 text-sm pl-5 flex flex-col list-decimal marker:font-bold"
            >
              <li>
                Click '<span class="font-medium">Continue to Amazon ➜</span>'
              </li>
              <li>
                Click '<span class="font-medium">Add To Cart</span>' on Amazon
              </li>
              <li>Items received!</li>
            </ol>
          </div>
          <div>
            <span
              class="block mt-5 sm:mt-0 text-amber-950 tracking-tight underline"
            >
              Contents:
            </span>
            <ul class="leading-6 text-sm pl-5 flex flex-col list-disc">
              <li>
                <span class="italic font-medium">From:</span>
                <span id="from_modal"></span>
              </li>
              <li>
                <span class="italic font-medium">Quantity:</span>
                <span id="quantity_modal"></span>
              </li>
              <li>
                <span class="italic font-medium">Different Items:</span>
                <span id="different_items_modal"></span>
              </li>
            </ul>
          </div>
        </div>
        <p class="text-center mt-5 text-xs text-stone-400 font-light">
          Product prices and availability are subject to change.
        </p>
      </div>
    </dialog>
    <script>
      const params = new URLSearchParams(document.location.search);
      let url = params.get("u");
      url = decodeURI(url);
      const parts = new URL(url).searchParams;
      const noteParam = params.get("note");
      const localMarkets = {
        // US
        QW1hem9uIEZyZXNo: "Fresh",
        VUZHIFdob2xlIEZvb2Rz: "Whole Foods",
        cfr1WQ8obY: "Everyday Essentials",
        hJDG4SCSoK: "Metropolitan Market",
        U2F2ZSBNYXJ0: "Save Mart",
        WPcGbYPLzk: "Rite Aid",
        WQppp1xWMK: "Lucky",
        RDMXfFItJA: "Cardenas Market",
        hY0j6LN5aS: "New Seasons Market",
        pNHniBOEyG: "Foodmaxx",
        YnJpc3RvbCBmYXJtcw: "Bristol Farms",
        QmFydGVsbCBEcnVncw: "Bartell's",
        V2VpcyBNYXJrZXRz: "Weis",
        // UK
        TW9ycmlzb25z: "Morrisons",
        Q29vcA: "Coop",
        ejEjkXsQmO: "Iceland",
        // Singapore
        KQENHJywk4: "Watsons",
        WDpqStVxNA: "Little Farms",
        // India
        ctnow: "Fresh",
        foq3ZnlEaO: "FreshMeat",
        // Germany
        dGVndXQuLi4: "Tegut",
        tIldpRhPE0: "konuspr",
        // France
        TW9ub3ByaXg: "Monoprix",
        // Japan
        "44OQ44Ot44O8": "Valor",
        "44Op44Kk44OV": "Life",
        YuevU6kVCi: "ARCS",
        "5oiQ5Z1O551z5LqV": "Seijo Ishii",
        qg6iObTGYS: "Marukyo",
        // Italy
        VTIgU3VwZXJtZXJjYXRv: "Unes",
        UGFtIFBBTk9SQU1B: "Pam Panorama",
        VHVvZMOs: "Tuodi",
        // Spain
        TWVyY2FkbyBkZSBMYSBQYXo: "Mercado de la Paz",
        TGEgUGxhemEgZGUgRGlh: "Dia",
        // Mexico
        qhu7HKnZL6: "Justo",
        // UAE
        Wf2HUUZ9yC: "Lulu",
        sAuWWBROaG: "Amazon Now",
      };

      let associateTag = window.location.href.includes("sharecarts.com")
        ? "sharecarts0c-20"
        : "none";

      if (new URL(url).hostname == "www.amazon.in") {
        associateTag = "test";
      }

      function updateTotalQuantity() {
        // parse total items
        let totalQuantity = 0;
        let differentItems = 0;
        for (const [key, value] of parts) {
          if (key.includes("Quantity")) {
            totalQuantity = totalQuantity + parseInt(value);
            differentItems++;
          }
        }

        if (totalQuantity == 1) {
          document.querySelector(
            "#quantity"
          ).textContent = `${totalQuantity} item`;
        } else {
          document.querySelector(
            "#quantity"
          ).textContent = `${totalQuantity} items`;
        }
        document.querySelector("#quantity_modal").textContent = totalQuantity; // upate modal
        document.querySelector("#different_items_modal").textContent =
          differentItems; // upate modal
      }

      function main() {
        if (!new URL(url).pathname.includes("add.html")) {
          branded();
          return;
        }

        const amz = document.querySelector("a#amz");
        let region;

        // update tld text
        if (new URL(url).hostname.split(".").length > 3) {
          region = `${new URL(url).hostname.split(".")[2]}.${new URL(
            url
          ).hostname
            .split(".")
            .pop()}`;
          document.querySelector("#tld").textContent = `.${region}`;
          document.querySelector(
            "#from_modal"
          ).textContent = `Amazon.${region}`;
        } else {
          region = `${new URL(url).hostname.split(".").pop()}`;
          document.querySelector("#tld").textContent = `.${region}`;
          document.querySelector(
            "#from_modal"
          ).textContent = `Amazon.${region}`;
        }

        // update url
        amz.classList.remove("hidden");

        if (
          region == "com" ||
          region == "ca" ||
          region == "pl" ||
          region == "in" ||
          region == "co.jp" ||
          region == "ae" ||
          region == "sa"
        ) {
          amz.setAttribute(
            "href",
            `${url}AssociateTag=${associateTag}#:~:text=${encodeURIComponent(
              "Add To Cart"
            )}`
          );
        } else {
          amz.setAttribute(
            "href",
            `${url}AssociateTag=${associateTag}#:~:text=${encodeURIComponent(
              "Add to basket"
            )}`
          );
        }

        // update total quantity
        updateTotalQuantity();
      }

      function branded() {
        const pathName = new URL(url).pathname.slice(1);
        const freshWF = document.querySelector("form#freshWF");
        const payload = {
          ingredients: [],
          saved: false,
          recipeComposition: {
            saved: false,
          },
        };
        const brandId = localMarkets[pathName] ? pathName : "QW1hem9uIEZyZXNo";
        const brandName = localMarkets[pathName]
          ? localMarkets[pathName]
          : "Fresh";

        // insert ingredients
        let index = 1;
        for (const [key, value] of parts) {
          if (key.includes("ASIN")) {
            payload.ingredients.push({
              name: "Of This Item",
              asinOverrides: [value],
              componentIndex: 0,
              quantityList: [
                {
                  unit: "COUNT",
                  amount: parseInt(parts.get(`Quantity.${index}`) ?? 1),
                },
              ],
              exclusiveOverride: false,
            });
            index++;
          }
        }

        // update total quantity
        updateTotalQuantity();

        // update form
        freshWF.classList.remove("hidden");
        freshWF.action = `https://${
          new URL(url).hostname
        }/afx/ingredients/landing`;
        document.querySelector("#almBrandId").value = brandId;
        document.querySelector("#ingredients").value = JSON.stringify(payload);
        document.querySelector("#tag").value = associateTag;
        document.querySelector(
          'input[type="submit"]'
        ).value = `Continue to Amazon ${brandName} ➜`;

        // update copy
        document.querySelector("#instructions").textContent =
          "Click the 'Add selected items to cart' button.";
        document.querySelector(
          "#from_modal"
        ).textContent = `Amazon ${brandName}`;
        document.title = `${document.title} ${brandName}`;
      }

      function newEgg() {
        const amz = document.querySelector("a#amz");

        // update url
        amz.classList.remove("hidden");
        amz.setAttribute("rel", "noreferrer");
        amz.textContent = "Continue to Newegg";
        amz.setAttribute(
          "href",
          `https://click.linksynergy.com/deeplink?id=AV2nh8Bm4bQ&mid=44583&murl=${encodeURIComponent(
            url
          )}`
        );

        // remove colors
        document.querySelector("#container").classList.remove("bg-amber-50");
        document
          .querySelector("#container")
          .classList.remove("border-amber-200");
        amz.classList.remove("bg-amber-400");
        amz.classList.remove("hover:bg-amber-500");
        amz.classList.remove("text-amber-950");

        // add colors
        document.querySelector("#container").classList.add("bg-[#F6F6F6]");
        document.querySelector("#container").classList.add("border-[#CDCCCC]");
        amz.classList.add("bg-[#004B7D]");
        amz.classList.add("hover:bg-[#20304D]");
        amz.classList.add("text-white");

        // update meta
        document.title = "Continue to Newegg";
        document.querySelector("#help_first").classList.add("hidden");
        document.querySelector("#cart_info svg").classList.add("hidden");
        document.querySelector("#quantity").textContent = "a cart";
        document.querySelector("#disclosure").textContent =
          "We may earn an affiliate commission from any purchases facilitated through the use of this website.";
      }

      if (url) {
        if (url.includes("amazon")) {
          main();
        } else if (url.includes("newegg")) {
          newEgg();
        }
      }

      // NOTE
      if (noteParam) {
        const note = document.querySelector("#note");
        const noteMessage = document.querySelector("#noteMessage");
        note.classList.remove("hidden");
        noteMessage.textContent = decodeURIComponent(noteParam);
      }

      // SHARE ACTION
      document
        .querySelector("#share_button")
        .addEventListener("click", async (event) => {
          await navigator.share({
            title: "I want to share my cart with you! Check it out!",
            url: window.location.href,
          });
        });

      // OPEN INFO MODAL
      document
        .querySelector("#cart_info")
        .addEventListener("click", (event) => {
          cart_details.showModal();
        });
    </script>
  </body>
</html>
